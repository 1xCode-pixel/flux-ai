<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>FLUX /// BY 1XCODE</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg-body: #050505; --sidebar-bg: #0a0a0a; --chat-bg: #000000;
            --border: #222; --text-main: #ECECEC; --text-muted: #888;
            --accent: #ffffff; 
            --pro-color: #d4af37; --ultra-color: #b026ff; --admin-color: #ffffff; 
            --danger: #ff4444; --success: #00ff88;
            --frost: rgba(255, 255, 255, 0.03);
        }

        body.tier-pro { --accent: var(--pro-color); }
        body.tier-ultra { --accent: var(--ultra-color); }
        body.tier-admin { --accent: var(--admin-color); }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Inter', sans-serif; margin: 0; height: 100dvh; display: flex; overflow: hidden; transition: --accent 0.5s; }

        /* --- ANIMATIONS --- */
        .snowflake { position: absolute; top: -10px; background: #fff; border-radius: 50%; opacity: 0.8; animation: fall linear infinite; pointer-events: none; z-index: 100000; }
        @keyframes fall { to { transform: translateY(105vh); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        @keyframes adminTurbulence {
            0% { transform: rotate(0deg) scale(1); border-radius: 45% 55% 50% 50% / 50% 45% 55% 50%; box-shadow: 0 0 15px 5px rgba(255,255,255,0.5); }
            50% { transform: rotate(180deg) scale(1.05); border-radius: 50% 45% 55% 50% / 45% 55% 50% 50%; box-shadow: 0 0 25px 10px rgba(255,255,255,0.8); }
            100% { transform: rotate(360deg) scale(1); border-radius: 45% 55% 50% 50% / 50% 45% 55% 50%; box-shadow: 0 0 15px 5px rgba(255,255,255,0.5); }
        }
        @keyframes ultraPulse {
            0% { box-shadow: 0 0 10px var(--ultra-color); border-color: var(--ultra-color); }
            50% { box-shadow: 0 0 20px var(--ultra-color), 0 0 40px var(--ultra-color); border-color: #fff; }
            100% { box-shadow: 0 0 10px var(--ultra-color); border-color: var(--ultra-color); }
        }

        /* --- UI CSS --- */
        .message-text { line-height: 1.6; font-size: 1rem; margin-top: 4px; overflow-x: auto; white-space: pre-wrap; }
        .katex { font-size: 1.1em; }
        .typing::after { content: '‚ñã'; animation: blink 1s infinite; margin-left: 2px; color: var(--accent); }
        @keyframes blink { 50% { opacity: 0; } }

        /* INTRO */
        #splash-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #000; z-index: 30000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease, visibility 0.8s; }
        #splash-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .splash-logo { font-family: 'JetBrains Mono'; font-size: 3rem; font-weight: 800; letter-spacing: -2px; color: #fff; }
        .loading-container { width: 220px; height: 3px; background: #222; border-radius: 3px; margin: 25px 0; overflow: hidden; }
        .loading-bar { height: 100%; width: 0%; background: var(--pro-color); border-radius: 3px; animation: loadProgress 2.5s cubic-bezier(0.4, 0.0, 0.2, 1) forwards; }
        .splash-credit { font-family: 'Inter'; font-size: 0.8rem; letter-spacing: 4px; color: var(--pro-color); opacity: 0; animation: fadeIn 1s ease 1.2s forwards; }
        @keyframes loadProgress { 0% { width: 0%; } 40% { width: 30%; } 70% { width: 85%; } 100% { width: 100%; } }

        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 20000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-overlay.active { display: flex; animation: zoomIn 0.25s ease; }
        .modal-box { background: #0a0a0a; border: 1px solid #333; padding: 25px; border-radius: 20px; width: 95%; max-width: 550px; text-align: center; position: relative; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.9); }
        .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #666; cursor: pointer; font-size: 1.5rem; line-height: 1; }
        .close-btn:hover { color: #fff; }

        /* PRICING & BUTTONS */
        .pricing-container { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 5px; align-items: stretch; }
        .price-card { flex: 1; background: #111; border: 1px solid #333; border-radius: 12px; padding: 15px; min-width: 130px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; position: relative; transition: 0.3s; }
        .price-card:hover { transform: translateY(-3px); }
        .price-title { font-family: 'JetBrains Mono'; font-weight: bold; margin-bottom: 10px; font-size: 1.1rem; }
        .price-features { font-size: 0.75rem; color: #aaa; line-height: 1.8; margin-bottom: 15px; text-align: left; width: 100%; list-style: none; padding: 0; }
        .price-features li::before { content: '‚úì '; color: var(--success); }
        .price-badge { font-size: 0.7rem; padding: 6px 12px; border-radius: 20px; font-weight: bold; margin-top: auto; width: 100%; text-align:center; }
        .pc-free .price-title { color: #888; }
        .pc-free .price-badge { background: #222; color: #ccc; }
        .pc-pro .price-title { color: var(--pro-color); }
        .pc-pro .price-badge { background: var(--pro-color); color: #000; }
        .pc-ultra { border-color: rgba(176, 38, 255, 0.4); background: linear-gradient(180deg, #120516, #0a0a0a); }
        .pc-ultra .price-title { color: var(--ultra-color); text-shadow: 0 0 10px rgba(176,38,255,0.6); }
        .pc-ultra .price-badge { background: var(--ultra-color); color: #fff; box-shadow: 0 0 15px rgba(176, 38, 255, 0.4); }
        
        .key-input-section { border-top: 1px solid #333; padding-top: 20px; margin-top: 10px; }
        .key-input { width: 100%; background: #151515; border: 1px solid #333; padding: 15px; color: #fff; border-radius: 10px; text-align: center; font-family: 'JetBrains Mono'; margin-bottom: 10px; outline: none; font-size: 1rem; }
        .key-input:focus { border-color: var(--accent); }
        .auth-btn { background: #fff; color: #000; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; font-size: 0.9rem; transition: 0.2s; }
        .auth-btn:hover { opacity: 0.9; }

        /* SIDEBAR */
        #app { display: flex; width: 100%; height: 100%; flex-direction: row; }
        .sidebar { width: 280px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; position: relative; }
        .logo { font-family: 'JetBrains Mono'; font-weight: 700; font-size: 1.4rem; display: flex; align-items: center; gap: 8px; margin-bottom: 25px; }
        .pro-badge-logo { font-size: 0.6rem; background: var(--pro-color); color: #000; padding: 2px 5px; border-radius: 4px; display: none; }
        .pro-badge-logo.admin { background: #fff; color: #000; box-shadow: 0 0 10px rgba(255,255,255,0.8); display: inline-block !important; }
        body.pro-enabled .pro-badge-logo { display: inline-block; }
        .btn-new-chat { width: 100%; padding: 12px; background: var(--frost); border: 1px solid #333; color: #fff; border-radius: 8px; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .history-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; margin-bottom: 20px; -webkit-overflow-scrolling: touch; }
        .history-item { padding: 12px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; color: #aaa; display: flex; justify-content: space-between; }
        .history-item:hover { background: #1a1a1a; color: #fff; }
        .delete-btn { background: transparent; border: none; color: #444; cursor: pointer; padding: 0 10px; display: flex; opacity: 0; font-size: 1.2rem; }
        .history-item:hover .delete-btn { opacity: 1; }
        .sidebar-footer { margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 10px; }
        .user-profile { display: flex; align-items: center; gap: 10px; padding: 5px; user-select: none; }
        .user-avatar { width: 36px; height: 36px; background: #222; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid #333; transition: 0.3s; position: relative; z-index: 2; }
        body.tier-pro .user-avatar { border-color: var(--pro-color); color: var(--pro-color); }
        .user-avatar.ultra-mode { background: #1a0520; color: #fff; border: 1px solid #b026ff; animation: ultraPulse 2s infinite alternate; }
        .user-avatar.admin-mode { background: #fff; color: #000; border: none; }
        .user-avatar.admin-mode::before { content: ''; position: absolute; z-index: -1; top: -6px; left: -6px; right: -6px; bottom: -6px; background: linear-gradient(45deg, #ffffff, #e0e0e0); filter: blur(5px); opacity: 0.8; animation: adminTurbulence 3s linear infinite; }
        #userId { font-size: 0.7rem; color: #666; font-family: 'JetBrains Mono'; cursor: pointer; margin-top: 2px; }
        #userId:hover { color: var(--accent); }
        .pro-timer { font-size: 0.65rem; color: var(--pro-color); font-family: 'JetBrains Mono'; margin-top: 4px; display: none; }
        body.pro-enabled .pro-timer { display: block; }
        .btn-upgrade-sidebar { width: 100%; padding: 12px; margin-top: 5px; background: linear-gradient(90deg, #1a1a1a, #0a0a0a); border: 1px solid var(--pro-color); color: var(--pro-color); border-radius: 10px; cursor: pointer; font-size: 0.75rem; font-weight: bold; text-align: center; transition: 0.3s; letter-spacing: 1px; }
        .btn-upgrade-sidebar:hover { background: var(--pro-color); color: #000; box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); }
        .footer-credit { font-size: 0.65rem; color: #444; text-align: center; font-family: 'JetBrains Mono'; margin-top: 5px; cursor: default; }

        /* MAIN CONTENT */
        .main-content { flex: 1; display: flex; flex-direction: column; background-color: var(--chat-bg); position: relative; width: 100%; height: 100%; }
        .mobile-header { display: none; height: 60px; padding: 0 15px; border-bottom: 1px solid var(--border); align-items: center; justify-content: space-between; background: rgba(10,10,10,0.95); backdrop-filter: blur(10px); position: absolute; top: 0; left: 0; width: 100%; z-index: 50; }
        .top-bar-desktop { padding: 15px; display: flex; justify-content: center; position: absolute; top: 0; left: 0; right: 0; z-index: 10; pointer-events: none; }
        
        #chat-stream { flex: 1; overflow-y: auto; padding: 80px 20px 20px 20px; scroll-behavior: auto; -webkit-overflow-scrolling: touch; }
        .message-container { max-width: 800px; margin: 0 auto 25px auto; display: flex; gap: 15px; animation: slideUp 0.3s ease forwards; }
        .avatar { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; transition: 0.5s; position: relative; z-index: 1; }
        .avatar.ai { background: #fff; color: #000; }
        .avatar.user { background: #222; color: #fff; }
        
        .avatar.ai.pro-mode { background: var(--pro-color); box-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
        .avatar.ai.ultra-mode { background: var(--ultra-color); color: #fff; box-shadow: 0 0 15px rgba(176, 38, 255, 0.5); }
        .avatar.ai.admin-mode { background: #fff; color: #000; animation: adminTurbulence 3s infinite alternate; }

        .input-wrapper { max-width: 800px; margin: 0 auto; width: 100%; padding: 15px; background: linear-gradient(to top, #000 80%, transparent); display: flex; flex-direction: column; z-index: 60; }
        .input-box { background: #111; border: 1px solid var(--border); border-radius: 14px; padding: 10px 14px; display: flex; align-items: flex-end; gap: 10px; transition: 0.2s; }
        .input-box:focus-within { border-color: var(--accent); box-shadow: 0 0 20px rgba(255,255,255,0.05); }
        textarea { width: 100%; background: transparent; border: none; color: white; font-family: inherit; font-size: 1rem; resize: none; outline: none; max-height: 120px; padding: 10px 0; line-height: 1.3; }
        .file-preview { display: none; padding: 8px 12px; margin-bottom: 8px; background: #1a1a1a; border-radius: 8px; font-size: 0.8rem; color: #ccc; align-items: center; justify-content: space-between; max-width: 800px; margin: 0 auto 10px auto; border: 1px dashed #444; }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 900; display: none; }
        .overlay.active { display: block; }
        .burger-btn { background: none; border: none; color: #fff; cursor: pointer; padding: 5px; font-size: 1.5rem; }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 85%; transform: translateX(-100%); box-shadow: 5px 0 30px rgba(0,0,0,0.5); }
            .sidebar.open { transform: translateX(0); }
            .mobile-header { display: flex; }
            .top-bar-desktop { display: none; }
            #chat-stream { padding-top: 70px; padding-bottom: 80px; }
            .modal-box { width: 95%; max-height: 85vh; padding: 20px; }
        }

        /* CUSTOM STYLES FOR MODELS AND TOKENS */
        .header-right-group { display: flex; align-items: center; gap: 8px; margin-left: auto; }
        .tokens-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; padding: 8px 12px; display: flex; align-items: center; gap: 6px; cursor: pointer; color: #fff; transition: all 0.3s; }
        .tokens-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-1px); }
        .token-icon { font-size: 1.2em; }
        .token-count { font-weight: 600; }
        
        .model-btn-custom { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; padding: 8px 16px; cursor: pointer; transition: all 0.3s ease; color: #fff; font-family: inherit; }
        .model-btn-custom:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); transform: translateY(-1px); }
        .model-avatar-img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
        .model-text-info { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; }
        .model-name-main { font-size: 0.95em; font-weight: 500; color: #fff; }
        .model-name-short { font-size: 0.9em; color: #fff; }
        .model-cost-label { font-size: 0.75em; color: rgba(255,255,255,0.6); }

        /* MODEL LIST ITEMS */
        .model-item { padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .model-item:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.2); transform: translateX(5px); }
        .model-item.active { background: rgba(102,126,234,0.2); border-color: #667eea; }
        .model-name { color: #fff; font-weight: 600; font-size: 1.1em; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .model-info { color: rgba(255,255,255,0.6); font-size: 0.85em; }
        .model-badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.75em; font-weight: 600; }
        .badge-free { background: rgba(74,222,128,0.2); color: #4ade80; }
        .badge-paid { background: rgba(251,191,36,0.2); color: #fbbf24; }
        .badge-text { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .badge-vision { background: rgba(139,92,246,0.2); color: #8b5cf6; }

        /* MODAL CONTAINER OVERRIDE */
        .modal-container { background: #0a0a0a; border: 1px solid #333; width: 90%; max-width: 600px; border-radius: 16px; padding: 20px; position: relative; max-height: 80vh; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0,0,0,0.9); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .modal-header h2 { margin: 0; color: #fff; font-size: 1.2rem; }
        .modal-close { background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer; }
        .modal-close:hover { color: #fff; }
        .modal-body { flex: 1; overflow-y: auto; padding-right: 5px; }
        .modal-body::-webkit-scrollbar { width: 6px; }
        .modal-body::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    </style>
</head>
<body>

    <div id="snow-container"></div>

    <div id="splash-screen">
        <div class="splash-logo">FLUX üéÑ AI</div>
        <div class="loading-container"><div class="loading-bar"></div></div>
        <div class="splash-credit">BY 1XCODE</div>
    </div>

    <div id="tokensModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üíé –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤</h2>
                <button class="modal-close" onclick="closeTokensModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align:center;padding:20px;background:rgba(255,255,255,0.03);border-radius:8px;margin-bottom:20px;">
                    <div style="color:rgba(255,255,255,0.6);margin-bottom:8px;">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:</div>
                    <div id="currentBalance" style="color:#fff;font-size:1.8em;font-weight:700;">0 —Ç–æ–∫–µ–Ω–æ–≤</div>
                </div>
                <input type="text" id="activationCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" style="width:100%;padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.15);border-radius:6px;color:#fff;margin-bottom:10px;box-sizing:border-box;">
                <button id="activateCodeBtn" style="width:100%;padding:12px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:6px;color:#fff;font-weight:600;cursor:pointer;">‚ú® –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                <div id="activationResultMsg" style="display:none;padding:12px;margin-top:10px;border-radius:6px;text-align:center;"></div>
                <div style="margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);">
                    <h4 style="color:#fff;font-size:0.9em;margin-bottom:10px;">üí° –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–º–æ–∫–æ–¥–∞:</h4>
                    <div style="text-align:center;">
                        <code style="background:rgba(255,255,255,0.1);padding:6px 12px;border-radius:6px;font-size:1.2em;color:#4ade80;">FREE500</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modelModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 650px;">
            <div class="modal-header">
                <h2>ü§ñ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏</h2>
                <button class="modal-close" onclick="closeModelModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modelsList"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="pricingModal">
        <div class="modal-box">
            <button class="close-btn" onclick="document.getElementById('pricingModal').classList.remove('active')">‚úï</button>
            <h3 style="color: #fff; margin-bottom: 20px;">–¢–ê–†–ò–§–´ FLUX</h3>
            <div class="pricing-container">
                <div class="price-card pc-free"><div class="price-title">FREE</div><ul class="price-features"><li>3 –∑–∞–ø—Ä–æ—Å–∞/—á–∞—Å</li><li>1 –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ</li></ul><div class="price-badge">–í–∞—à —Ç–∞—Ä–∏—Ñ</div></div>
                <div class="price-card pc-pro"><div class="price-title">PRO</div><ul class="price-features"><li>100 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å</li><li>50 —Ñ–æ—Ç–æ/—á–∞—Å</li></ul><div class="price-badge">199‚ÇΩ</div></div>
                <div class="price-card pc-ultra"><div class="price-title">ULTRA</div><ul class="price-features"><li>500 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å</li><li>500 —Ñ–æ—Ç–æ/—á–∞—Å</li></ul><div class="price-badge">499‚ÇΩ</div></div>
            </div>
            <div class="key-input-section">
                <div style="font-size:0.8rem; color:#aaa; margin-bottom:10px;">–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø–∞:</div>
                <input type="text" id="licenseKey" class="key-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á (PRO-XXX)">
                <button class="auth-btn" style="background:var(--accent); color:#000;" onclick="activateKey()">üöÄ –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨</button>
                <div style="margin-top:10px; font-size:0.7rem; color:#666;">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –∫–ª—é—á: <a href="#" style="color:var(--accent);">Flux Shop</a></div>
            </div>
        </div>
    </div>

    <div class="admin-pass-popup" id="adminPassPopup">
        <div class="security-title">/// SECURITY CHECK ///</div>
        <input type="password" id="adminKey" class="admin-key-input" placeholder="Admin Key">
        <button class="unlock-btn" onclick="verifyAdmin()">UNLOCK</button>
    </div>

    <div class="modal-overlay" id="adminModal">
        <div class="modal-box">
            <button class="close-btn" onclick="closeAdmin()">‚úï</button>
            <div style="font-family: 'JetBrains Mono'; color: var(--success); font-weight: bold; margin-bottom: 20px;">–ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</div>
            <div class="admin-section">
                <span style="color: #888; font-size: 0.7rem; display: block; margin-bottom: 10px;">–ú–û–ô –°–¢–ê–¢–£–°</span>
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px;">
                    <span style="color: #ccc;">PRO</span><div class="toggle-switch" id="proToggle" onclick="togglePro()"></div>
                </div>
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-top:10px;">
                    <span style="color: #fff; font-weight:bold;">ADMIN</span><div class="toggle-switch" id="adminToggle" onclick="toggleAdmin()"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="legalModal">
        <div class="modal-box" style="text-align: left; max-width: 600px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:10px;">
                <h3 style="color: var(--accent); margin:0;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –°–æ–≥–ª–∞—à–µ–Ω–∏–µ</h3>
                <button class="close-btn" style="position:static;" onclick="document.getElementById('legalModal').classList.remove('active')">‚úï</button>
            </div>
            <div class="legal-content" id="kilometerText"></div>
        </div>
    </div>

    <div class="popup-overlay" id="disclaimerPopup">
        <div class="small-modal">
            <h2 style="font-size: 3rem; margin: 0 0 10px 0;">üéÑ</h2>
            <h3 style="color: var(--accent); margin-bottom: 15px;">Flux AI Update</h3>
            <p style="color: #aaa; font-size: 0.9rem; line-height: 1.5; margin-bottom: 20px;">Node: 1xCode.</p>
            <button class="auth-btn" style="width: 100%; padding: 10px;" onclick="acceptDisclaimer()">–ü–†–ò–ù–Ø–¢–¨</button>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleSidebar(false)"></div>

    <div id="app">
        <aside class="sidebar" id="sidebar">
            <div class="logo">FLUX <span>AI</span> <div class="pro-badge-logo" id="proBadge">PRO</div></div>
            <button class="btn-new-chat" onclick="startNewChat()">+ –ù–æ–≤—ã–π —á–∞—Ç</button>
            <div class="history-list" id="historyList"></div>
            <div class="sidebar-footer">
                <button onclick="localStorage.clear();location.reload();" style="background:none; border:none; color:#666; cursor:pointer; font-size: 0.8rem; text-align: left;">üóë –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</button>
                <div class="user-profile">
                    <div class="user-avatar" id="myAvatar">U</div>
                    <div class="user-info">
                        <div style="font-size:0.9rem;" id="userName">–ì–æ—Å—Ç—å</div>
                        <div style="font-size:0.65rem; color:#666; font-family: 'JetBrains Mono';" id="userId" onclick="copyID()">UID...</div>
                    </div>
                </div>
                <button class="btn-upgrade-sidebar" onclick="document.getElementById('pricingModal').classList.add('active')">üíé –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ü–û–î–ü–ò–°–ö–£</button>
                <div class="footer-credit" id="secretTrigger">CREATED BY <span>1XCODE</span></div>
            </div>
        </aside>

        <main class="main-content">
            <header class="mobile-header">
                <button class="burger-btn" onclick="toggleSidebar(true)">‚ò∞</button>
                <div class="header-right-group">
                    <button class="tokens-btn" id="tokensBtnMob" onclick="openTokensModal()">
                        <span class="token-icon">üíé</span> <span class="token-count" id="tokenCountMob">0</span>
                    </button>
                    <button class="model-btn-custom" id="mobModelBtn" onclick="openModelModal()">
                        <img class="model-avatar-img" id="mobModelAvatar" src="https://api.dicebear.com/7.x/shapes/svg?seed=ai" alt="">
                        <span class="model-name-short" id="mobModelName">–í—ã–±—Ä–∞—Ç—å</span>
                    </button>
                </div>
            </header>

            <div class="top-bar-desktop">
                <div class="header-right-group">
                    <button class="tokens-btn" id="tokensBtnDesk" onclick="openTokensModal()">
                        <span class="token-icon">üíé</span> <span class="token-count" id="tokenCountDesk">0</span>
                    </button>
                    <button class="model-btn-custom" id="deskModelBtn" onclick="openModelModal()">
                        <img class="model-avatar-img" id="deskModelAvatar" src="https://api.dicebear.com/7.x/shapes/svg?seed=ai" alt="">
                        <div class="model-text-info">
                            <span class="model-name-main" id="deskModelName">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</span>
                            <span class="model-cost-label" id="deskModelCost">-</span>
                        </div>
                    </button>
                </div>
            </div>

            <div id="chat-stream">
                <div class="message-container">
                    <div class="avatar ai">‚óà</div>
                    <div class="message-text">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∏ –Ω–∞—á–Ω–∏—Ç–µ —á–∞—Ç! üéÑ</div>
                </div>
            </div>

            <div class="file-preview" id="filePreview"><span>üìÑ <span id="fileName">file</span></span><span style="cursor:pointer;" onclick="clearFile()">‚úï</span></div>

            <div class="input-wrapper" id="inputWrapper">
                <div class="input-box">
                    <button class="btn-clip" onclick="document.getElementById('fileIn').click()">üìé</button>
                    <input type="file" id="fileIn" style="display:none" onchange="handleFile(this)">
                    <textarea id="userInput" rows="1" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
                    <button class="auth-btn" style="margin:0; padding:0; width:35px; height:35px;" onclick="sendMsg()">‚Üí</button>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <span style="font-size: 0.7rem; color: #444; cursor: pointer; text-decoration: underline;" onclick="openLegal()">–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (1xCode Agreement)</span>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        // ‚úÖ –í–ê–ñ–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–õ–Ø VERCEL (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å)
        const API_URL = '/api'; 

        const PASS_HASH = "Zmx1eDIwMjU=";
        let chats = JSON.parse(localStorage.getItem('chats_v57') || '[]');
        let myUID = localStorage.getItem('myUID') || 'u-' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('myUID', myUID);
        let activeId = null;
        let currFile = null;
        let clicks = 0;
        let isPro = false;
        let isAdmin = false;

        const PROMO_CODES = {'FREE500':500,'PREMIUM10K':10000,'VIP':50000};
        const MODELS=[
            {id:'mistralai/mistral-7b-instruct:free',name:'Mistral 7B',provider:'Mistral AI',siteFree:true,vision:false,cost:0},
            {id:'google/gemma-2-9b-it:free',name:'Gemma 2 9B',provider:'Google',siteFree:true,vision:false,cost:0},
            {id:'meta-llama/llama-3.2-11b-vision-instruct:free',name:'Llama 3.2 11B',provider:'Meta',siteFree:true,vision:true,cost:0},
            {id:'meta-llama/llama-3.3-70b-instruct:free',name:'Llama 3.3 70B',provider:'Meta',siteFree:false,vision:false,cost:100},
            {id:'qwen/qwen-2.5-coder-32b-instruct:free',name:'Qwen 2.5 Coder',provider:'Qwen',siteFree:false,vision:false,cost:80},
            {id:'google/gemini-2.0-flash-exp:free',name:'Gemini 2.0 Flash',provider:'Google',siteFree:false,vision:true,cost:150},
            {id:'meta-llama/llama-3.2-90b-vision-instruct:free',name:'Llama 3.2 90B Vision',provider:'Meta',siteFree:false,vision:true,cost:200}
        ];
        let currentModel=MODELS[0];

        // --- TOKEN LOGIC ---
        function getBalance(){return parseInt(localStorage.getItem('userTokens')||'0')}
        function setBalance(amount){localStorage.setItem('userTokens',amount.toString())}
        function getUsedCodes(){const u=localStorage.getItem('usedPromoCodes');return u?JSON.parse(u):[]}
        function markCodeAsUsed(code){const u=getUsedCodes();u.push(code);localStorage.setItem('usedPromoCodes',JSON.stringify(u))}
        function spendTokens(amount){
            if (isPro || isAdmin) return true; // FREE FOR PRO/ADMIN
            const balance=getBalance();
            if(balance<amount)return false;
            setBalance(balance-amount);updateBalanceDisplay();return true;
        }
        function refundTokens(amount){
            if (isPro || isAdmin) return;
            setBalance(getBalance()+amount);updateBalanceDisplay();
        }
        function canUseModel(model){if(model.siteFree || isPro || isAdmin)return true;return getBalance()>=model.cost}

        function updateBalanceDisplay(){
            const bal = (isPro || isAdmin) ? '‚àû' : getBalance().toLocaleString();
            ['tokenCountMob','tokenCountDesk'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerText=bal});
            const cur=document.getElementById('currentBalance');if(cur)cur.innerText=bal+' —Ç–æ–∫–µ–Ω–æ–≤';
        }

        window.activatePromoCode = function(){
            const input=document.getElementById('activationCodeInput');const msg=document.getElementById('activationResultMsg');const code=input.value.trim().toUpperCase();
            if(!code||!PROMO_CODES[code]){msg.innerText='‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥';msg.style.display='block';setTimeout(()=>msg.style.display='none',3000);return}
            if(getUsedCodes().includes(code)){msg.innerText='‚ùå –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω';msg.style.display='block';setTimeout(()=>msg.style.display='none',3000);return}
            const tokens=PROMO_CODES[code];setBalance(getBalance()+tokens);markCodeAsUsed(code);
            msg.innerText='‚úÖ +'+tokens+' —Ç–æ–∫–µ–Ω–æ–≤!';msg.style.display='block';msg.style.color='#4ade80';
            input.value='';updateBalanceDisplay();
        }

        window.openTokensModal=()=>document.getElementById('tokensModal').classList.add('active');
        window.closeTokensModal=()=>document.getElementById('tokensModal').classList.remove('active');

        // --- MODEL SELECTOR ---
        window.openModelModal=function(){
            document.getElementById('modelModal').classList.add('active');
            const list=document.getElementById('modelsList');
            let html='<h3 style="color:#4ade80;margin-bottom:10px;">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ</h3>';
            MODELS.filter(m=>m.siteFree).forEach(m=>html+=renderModelItem(m));
            html+='<h3 style="color:#fbbf24;margin-top:20px;margin-bottom:10px;">Premium (–∑–∞ —Ç–æ–∫–µ–Ω—ã)</h3>';
            MODELS.filter(m=>!m.siteFree).forEach(m=>html+=renderModelItem(m));
            list.innerHTML=html;
        }
        function renderModelItem(m){
            const active = currentModel.id === m.id ? 'active' : '';
            const cost = m.siteFree ? 'FREE' : `üíé ${m.cost}`;
            const vision = m.vision ? '<span class="model-badge badge-vision">üì∑ VISION</span>' : '<span class="model-badge badge-text">üìù TEXT</span>';
            return `<div class="model-item ${active}" onclick="selectModel('${m.id}')">
                        <div class="model-name">${m.name} <span class="model-badge badge-free">${cost}</span></div>
                        <div class="model-info">${m.provider} ${vision}</div>
                    </div>`;
        }
        window.closeModelModal=()=>document.getElementById('modelModal').classList.remove('active');
        
        window.selectModel=function(id){
            const m=MODELS.find(x=>x.id===id);
            if(m){
                if(!m.siteFree && !canUseModel(m)){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!'); openTokensModal(); return; }
                currentModel=m; updateModelUI(); closeModelModal();
            }
        }
        function updateModelUI(){
            const txt = currentModel.name;
            document.getElementById('mobModelName').innerText = txt.split(' ')[0];
            document.getElementById('deskModelName').innerText = txt;
            document.getElementById('mobModelAvatar').src = `https://api.dicebear.com/7.x/shapes/svg?seed=${currentModel.provider}`;
            document.getElementById('deskModelAvatar').src = `https://api.dicebear.com/7.x/shapes/svg?seed=${currentModel.provider}`;
            const costEl = document.getElementById('deskModelCost');
            if(currentModel.siteFree) { costEl.innerText="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ"; costEl.style.color="#4ade80"; }
            else { costEl.innerText=`üíé ${currentModel.cost}`; costEl.style.color="#fbbf24"; }
        }

        // --- CHAT LOGIC ---
        window.onload = () => {
            document.getElementById('userId').innerText = "UID: " + myUID;
            updateBalanceDisplay(); updateModelUI();
            createSnow();
            setTimeout(()=>document.getElementById('splash-screen').style.display='none', 2000);
            if(chats.length) { chats.sort((a,b)=>b.ts-a.ts); loadChat(chats[0].id); }
        }

        window.sendMsg = async () => {
            const txt = document.getElementById('userInput').value.trim();
            if(!txt && !currFile) return;
            
            // Spend Tokens
            if(!currentModel.siteFree && !isPro && !isAdmin) {
                if(!spendTokens(currentModel.cost)){ alert('–ù—É–∂–Ω—ã —Ç–æ–∫–µ–Ω—ã!'); openTokensModal(); return; }
            }

            if(!activeId) {
                const nid = Date.now();
                chats.unshift({id:nid, title: txt.slice(0,15)||'–ß–∞—Ç', ts:nid, msgs:[]});
                activeId = nid;
            }
            const c = chats.find(x=>x.id===activeId);
            c.msgs.push({role:'user', text:txt, file:currFile});
            appendMsg('user', txt, currFile);
            
            const payload = {
                message: txt,
                file: currFile ? currFile.data : null,
                model: currentModel.id
            };

            document.getElementById('userInput').value=''; currFile=null;
            document.getElementById('filePreview').style.display='none';
            renderHistory();

            const aiDiv = appendMsg('ai', '', null, true);
            const textEl = aiDiv.querySelector('.message-text');
            textEl.classList.add('typing');

            try {
                const res = await fetch(API_URL + '/chat', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                
                textEl.classList.remove('typing');
                textEl.innerHTML = marked.parse(data.reply);
                if(window.renderMathInElement) renderMathInElement(textEl);
                c.msgs.push({role:'ai', text:data.reply});
                localStorage.setItem('chats_v57', JSON.stringify(chats));
            } catch(e) {
                textEl.innerText = "–û—à–∏–±–∫–∞: " + e.message;
                // Refund if error
                if(!currentModel.siteFree && !isPro && !isAdmin) refundTokens(currentModel.cost);
            }
        }

        window.appendMsg = (role, text, file, anim) => {
            const d = document.createElement('div'); d.className='message-container';
            let fh = file ? `<div>üìÑ [–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω]</div>` : '';
            let content = anim ? `<div class="message-text typing"></div>` : `<div class="message-text">${marked.parse(text)}</div>`;
            d.innerHTML = `<div class="avatar ${role}">${role==='user'?'U':'‚óà'}</div><div>${fh}${content}</div>`;
            document.getElementById('chat-stream').appendChild(d);
            if(!anim && role==='ai' && window.renderMathInElement) renderMathInElement(d);
            return d;
        }

        window.handleFile = function(i) {
            const f = i.files[0];
            if(f){
                const r = new FileReader();
                r.onload = e => {
                    currFile = {name:f.name, type:f.type, data:e.target.result};
                    document.getElementById('filePreview').style.display='flex';
                    document.getElementById('fileName').innerText=f.name;
                };
                r.readAsDataURL(f);
            }
        }
        window.clearFile = function() { currFile = null; document.getElementById('filePreview').style.display='none'; }
        
        window.copyID = () => navigator.clipboard.writeText(myUID);
        window.openLegal = () => document.getElementById('legalModal').classList.add('active');
        
        window.startNewChat = () => { activeId=null; document.getElementById('chat-stream').innerHTML=''; renderHistory(); }
        window.loadChat = (id) => { 
            const c=chats.find(x=>x.id===id); 
            if(c){ activeId=id; document.getElementById('chat-stream').innerHTML=''; c.msgs.forEach(m=>appendMsg(m.role,m.text,m.file)); renderHistory(); }
        }
        window.renderHistory = () => {
            const l=document.getElementById('historyList'); l.innerHTML='';
            chats.forEach(c => {
                const i=document.createElement('div'); i.className='history-item';
                i.innerHTML=`<span>${c.title}</span> <button class="delete-btn" onclick="delChat(event,${c.id})">‚úï</button>`;
                i.onclick=(e)=>{if(e.target.tagName!=='BUTTON')loadChat(c.id)};
                l.appendChild(i);
            });
        }
        window.delChat = (e,id) => { e.stopPropagation(); chats=chats.filter(x=>x.id!==id); localStorage.setItem('chats_v57', JSON.stringify(chats)); renderHistory(); startNewChat(); }

        window.toggleSidebar = (o) => {
            const s=document.getElementById('sidebar'); const ov=document.getElementById('overlay');
            if(o){s.classList.add('open');ov.classList.add('active');}else{s.classList.remove('open');ov.classList.remove('active');}
        }

        // ADMIN LOGIC
        document.getElementById('secretTrigger').onclick = () => { clicks++; if(clicks===7) { document.getElementById('adminPassPopup').style.display='block'; clicks=0; } };
        window.verifyAdmin = () => { if(btoa(document.getElementById('adminKey').value)===PASS_HASH) { document.getElementById('adminPassPopup').style.display='none'; document.getElementById('adminModal').classList.add('active'); } else alert('‚õîÔ∏è'); }
        window.closeAdmin = () => document.getElementById('adminModal').classList.remove('active');
        window.togglePro = () => { isPro = !isPro; updateStatusUI(); updateBalanceDisplay(); };
        window.toggleAdmin = () => { isAdmin = !isAdmin; isPro=isAdmin; updateStatusUI(); updateBalanceDisplay(); };
        
        window.updateStatusUI = () => {
            const b = document.body; 
            const badge = document.querySelector('.pro-badge-logo');
            b.classList.remove('pro-enabled', 'admin-enabled');
            if(badge) { badge.style.display = 'none'; badge.classList.remove('admin'); }
            if(isAdmin) { b.classList.add('admin-enabled'); if(badge){badge.innerText="ADMIN";badge.classList.add('admin');badge.style.display='inline-block';} }
            else if(isPro) { b.classList.add('pro-enabled'); if(badge){badge.innerText="PRO";badge.style.display='inline-block';} }
        }
        window.generateLegalText = () => document.getElementById('kilometerText').innerText = `–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ï –°–û–ì–õ–ê–®–ï–ù–ò–ï...`;
    </script>
</body>
    </html>




































































